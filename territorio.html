<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Virtual - Territorio</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Panel de Navegaci√≥n -->
    <div id="navPanel">
        <div class="nav-header">
            <button id="backToSelector" class="nav-btn">
                <i class="fas fa-arrow-left"></i> Territorios
            </button>
            <h1 id="territoryTitle">Cargando...</h1>
        </div>
        <div class="nav-controls">
            <button id="btnMiUbicacion" class="nav-btn">
                <i class="fas fa-location-dot"></i> Mi Ubicaci√≥n
            </button>
            <button id="btnSiguiente" class="nav-btn primary">
                <i class="fas fa-play"></i> Siguiente
            </button>
            <button id="btnAudio" class="nav-btn">
                <i class="fas fa-volume-up"></i> Audio
            </button>
        </div>
    </div>

    <!-- Mapa -->
    <div id="map"></div>

    <!-- Panel de Informaci√≥n -->
    <div id="infoPanel" class="info-panel hidden">
        <div class="info-header">
            <h3 id="poiNombre">Punto de Inter√©s</h3>
            <button id="btnCerrarInfo" class="close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="info-content">
            <div id="poiImagen" class="poi-image"></div>
            <div id="poiDescripcion" class="poi-description"></div>
            <div id="poiInformacion" class="poi-information"></div>
        </div>
        <div class="info-actions">
            <button id="btnAudioPoi" class="info-btn">
                <i class="fas fa-play"></i> Escuchar Audio
            </button>
            <button id="btnNavegar" class="info-btn primary">
                <i class="fas fa-route"></i> Ir a este lugar
            </button>
        </div>
    </div>

    <!-- Panel de Testing (oculto en producci√≥n) -->
    <div id="testingPanel" class="testing-panel hidden">
        <h4>Panel de Testing</h4>
        <div class="testing-controls">
            <button onclick="window.guia.mostrarTodosPOIs()">Mostrar todos los POIs</button>
            <button onclick="window.guia.probarAudio()">Probar Audio</button>
            <button onclick="window.guia.centrarMapa()">Centrar Mapa</button>
        </div>
        <div id="debugInfo"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Obtener ID del territorio desde URL
            const urlParams = new URLSearchParams(window.location.search);
            let territoryId = urlParams.get('id');
            
            // Si no hay ID espec√≠fico, usar La Floresta por defecto
            if (!territoryId) {
                territoryId = 'la-floresta';
            }

            try {
                // Cargar configuraci√≥n de territorios
                const response = await fetch('territorios/config.json');
                const config = await response.json();
                
                // Encontrar el territorio
                const territory = config.territorios.find(t => t.id === territoryId);
                
                console.log('üîç Territorio solicitado:', territoryId);
                console.log('üìã Configuraci√≥n cargada:', config);
                console.log('üéØ Territorio encontrado:', territory);
                
                if (!territory) {
                    throw new Error(`Territorio ${territoryId} no encontrado`);
                }

                // Actualizar t√≠tulo
                document.getElementById('territoryTitle').textContent = territory.nombre;
                document.title = `Gu√≠a Virtual - ${territory.nombre}`;

                // Inicializar la gu√≠a con el territorio espec√≠fico
                try {
                    window.guia = new GuiaVirtual(territoryId, territory);
                    console.log('‚úÖ GuiaVirtual inicializada correctamente');
                } catch (guiaError) {
                    console.error('‚ùå Error en GuiaVirtual:', guiaError);
                    // No redirigir autom√°ticamente, permitir que se vea el error espec√≠fico
                    document.body.innerHTML += `<div style="position:fixed;top:0;left:0;right:0;background:red;color:white;padding:20px;z-index:9999;">
                        ERROR: ${guiaError.message}<br>
                        <button onclick="window.location.href='selector.html'">Volver al Selector</button>
                        <button onclick="this.parentElement.style.display='none'">Ocultar Error</button>
                    </div>`;
                }
                
                // Configurar bot√≥n de regreso
                document.getElementById('backToSelector').addEventListener('click', () => {
                    window.location.href = 'selector.html';
                });

            } catch (error) {
                console.error('‚ùå Error cargando configuraci√≥n territorio:', error);
                document.body.innerHTML = `<div style="padding:20px;text-align:center;">
                    <h2>Error al cargar territorio</h2>
                    <p>Error: ${error.message}</p>
                    <button onclick="window.location.href='selector.html'" style="padding:10px 20px;background:#007bff;color:white;border:none;border-radius:5px;">
                        Volver al Selector
                    </button>
                    <button onclick="window.location.reload()" style="padding:10px 20px;background:#28a745;color:white;border:none;border-radius:5px;margin-left:10px;">
                        Reintentar
                    </button>
                </div>`;
            }
        });
    </script>
</body>
</html>